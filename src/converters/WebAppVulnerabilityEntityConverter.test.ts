import { Dictionary } from "../tenable";
import { createVulnerabilityEntities } from "./WebAppVulnerabilityEntityConverter";

test("convert vulnerability entities", () => {
  const vulnerabilitiesDictionary: Dictionary<any[]> = {
    "dualbootpartners.com": [
      {
        host_id: 1,
        hostname: "dualbootpartners.com",
        plugin_id: 112526,
        plugin_name: "Missing 'X-XSS-Protection' Header",
        plugin_family: "Web Applications",
        count: 1,
        severity_index: 0,
        severity: 1,
      },
      {
        vuln_index: 1,
        host_id: 1,
        hostname: "dualbootpartners.com",
        plugin_id: 112530,
        plugin_name: "SSL/TLS Versions Supported",
        plugin_family: "Web Servers",
        count: 1,
        severity_index: 1,
        severity: 0,
      },
      {
        vuln_index: 2,
        host_id: 1,
        hostname: "dualbootpartners.com",
        plugin_id: 115491,
        plugin_name: "SSL/TLS Cipher Suites Supported",
        plugin_family: "Web Servers",
        count: 1,
        severity_index: 2,
        severity: 0,
      },
      {
        vuln_index: 3,
        host_id: 1,
        hostname: "dualbootpartners.com",
        plugin_id: 98138,
        plugin_name: "Screenshot",
        plugin_family: "General",
        count: 1,
        severity_index: 3,
        severity: 0,
      },
    ],
    "dualboot.ru": [
      {
        vuln_index: 0,
        host_id: 1,
        hostname: "dualboot.ru",
        plugin_id: 98138,
        plugin_name: "Screenshot",
        plugin_family: "General",
        count: 1,
        severity_index: 0,
        severity: 0,
      },
      {
        vuln_index: 1,
        host_id: 1,
        hostname: "dualboot.ru",
        plugin_id: 98000,
        plugin_name: "Scan Information",
        plugin_family: "General",
        count: 1,
        severity_index: 1,
        severity: 0,
      },
      {
        vuln_index: 2,
        host_id: 1,
        hostname: "dualboot.ru",
        plugin_id: 98050,
        plugin_name: "Interesting response",
        plugin_family: "Web Applications",
        count: 3,
        severity_index: 2,
        severity: 0,
      },
    ],
  };

  const entities = createVulnerabilityEntities(vulnerabilitiesDictionary);

  expect(entities).toEqual([
    {
      _class: "Vulnerability",
      _key: "tenable_webapp_vulnerability_112530",
      _type: "tenable_webapp_vulnerability",
      count: 1,
      pluginFamily: "Web Servers",
      pluginId: 112530,
      pluginName: "SSL/TLS Versions Supported",
      severity: 0,
    },
    {
      _class: "Vulnerability",
      _key: "tenable_webapp_vulnerability_115491",
      _type: "tenable_webapp_vulnerability",
      count: 1,
      pluginFamily: "Web Servers",
      pluginId: 115491,
      pluginName: "SSL/TLS Cipher Suites Supported",
      severity: 0,
    },
    {
      _class: "Vulnerability",
      _key: "tenable_webapp_vulnerability_98138",
      _type: "tenable_webapp_vulnerability",
      count: 1,
      pluginFamily: "General",
      pluginId: 98138,
      pluginName: "Screenshot",
      severity: 0,
    },
    {
      _class: "Vulnerability",
      _key: "tenable_webapp_vulnerability_98000",
      _type: "tenable_webapp_vulnerability",
      count: 1,
      pluginFamily: "General",
      pluginId: 98000,
      pluginName: "Scan Information",
      severity: 0,
    },
    {
      _class: "Vulnerability",
      _key: "tenable_webapp_vulnerability_98050",
      _type: "tenable_webapp_vulnerability",
      count: 3,
      pluginFamily: "Web Applications",
      pluginId: 98050,
      pluginName: "Interesting response",
      severity: 0,
    },
  ]);
});
